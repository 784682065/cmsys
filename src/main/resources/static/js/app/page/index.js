/** * 首页 */var homes = {    init: function () {        var that = this;        this.bind();        setCookie("listBack","0","1");        setCookie('listType',"home","1");        setCookie("addOrView","add","1");        //if(localStorage.getItem("token")) {        var nowUser = getCookie("userId");        if (nowUser && nowUser != "") {            userId = nowUser;            commons.logIn();            this.getAllRight();            this.getListData();        } else {            $(".fileModal").show();            setTimeout(function () {                if (isLoginStatus == 0) {                    NativeApi.sasback();                }            }, 100000);        }        //}else{        //    NativeApi.getAPPToken();        //}    },    getAllRight: function () {        $.ajax({            url: server + "appGetMenu?app=Y",            type: "post",            dataType: "json",            async: false,            success: function (data) {                var value = data.menu;                var itemHtml = "";                $(value).each(function (i, d) {                    if(d.PCODE=="0"){                        itemHtml+='<div class="title">'+d.NAME+'</div>';                        $(value).each(function (e, f) {                            if(d.CODE== f.PCODE&& f.URL!="0"){                                itemHtml+='<div class="ico-item"><div class="img">' +                                '<a href="' + f.URL + '?app=Y"><img src="/static/img/app/'+ f.CODE+'.png"></a>' +                                '</div><div class="text">'+f.NAME+'</div></div>';                            }else if(d.CODE== f.PCODE&& f.URL=="0"){                                itemHtml+='<div class="title twoTitle">'+f.NAME+'</div>';                                $(value).each(function (h, k) {                                    if (f.CODE == k.PCODE && k.URL != "0") {                                        itemHtml+='<div class="ico-item"><div class="img">' +                                        '<a href="' + k.URL + '?app=Y"><img src="/static/img/app/'+ k.CODE+'.png"></a>' +                                        '</div><div class="text">'+k.NAME+'</div></div>';                                    }                                });                            }                        });                    }                });                $("#icos").html(itemHtml);            }, error: function (data) {                commons.errorToIndex(data);                commons.alertMsg("获取业务权限失败");            }        });    },    getListData: function () {  //待办、已办、跟踪列表数据请求接口        $.ajax({            url: server + "Todo/list?app=Y",            type: "post",            dataType: "json",            async: false,            data: {"offset": 1, "limit": 20},            success: function (data) {                var numText="";                if (data.total && data.total > 0) {                    if(parseInt(data.total)>99){                        numText="99";                    }else{                        numText = data.total;                    }                    $("#waitNum").addClass("num").text(numText);                } else {                    $("#waitNum").removeClass("num").text("");                }            }, error: function (data) {                $("#waitNum").removeClass("num").text("");            }        });    },    bind: function () {  //页面元素事件绑定        var that = this;        $(".tags").on("click", ".tag-item", function () {            listType = $(this).attr("data-type");            setCookie('listType', listType,"1");            setCookie("addOrView", "view","1");            location.href = listUrl;        });        $("#know").click(function () {  //提示信息弹窗，确定按钮            $(".dialog").fadeOut(300);        });        $(".slider").click(function () {            $(".fileModal").show();            $("#testId").val("");        });        $("#testLogin").click(function () {            if ($("#testId").val() != "") {                $(".fileModal").hide();                userId = $("#testId").val();                setCookie("userId", userId,"1");                commons.logIn();                homes.getAllRight();                homes.getListData();            }        });        $("#testCancel").click(function () {            $(".fileModal").hide();        });        $(".back").click(function () {  // 返回按钮            var backType = $(this).attr("data");            if (backType == "home") {                setCookie('userId',"","1");                setCookie('token',"",1);                commons.alertMsg("成功退出");                //commons.logOut();                NativeApi.sasback();            }        });        $("#icos").on("click",".text",function(){            var url=$(this).prev().find("a").attr("href");            if(url&&url!="") {                location.href = url;            }        });    }};