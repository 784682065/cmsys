single = {    init: function () {        tableType = "guns";        inputType = "text,checkTable";        needUserInfo = 1;        addOrView = getCookie("addOrView");        single.bind();        if (addOrView == "add") {            $(".back").attr("data", "add");            nps.initAdd();        } else if (addOrView == "view") {            $(".back").attr("data", "detail");            $(".tdAdd").hide().remove();            nps.initDetail();        }    },    npsView: function (data) {        var tableHtml = "",reportNum = "", deptNum = "";        if (data.manMsg && data.manMsg != "") {            var value = data.manMsg[0];            if (value && value != "") {                $("#cyrNamep").html(value.CYRNAME);                $("#sexp").html(numToContent.sexContent(value.GENDER));                $("#agep").html(value.AGE);                $("#addressp").html(value.ADDRESS);                //$("#countsp").html(value.COUNTS);                $("#caseBriefp").html(value.CASEBRIEF);                //0：隐藏、1：只读 ，2.可读写                //结论：CONCLUSION  报告编号：PRE_NUM  初次认定部门：PRE_DEPT                // gunPreifr gunNumifr gunDeptifr conclusionifr                if (value.CONCLUSION&&conclusionifr == "1") {                    $("#conclusionp").html(value.CASEBRIEF);                } else if (value.CONCLUSION&&conclusionifr == "2") {                    $("#conclusion").text(value.CASEBRIEF);                } else if (conclusionifr == "" || conclusionifr == "0") {                    $(".conclusion,.preifr").hide().remove();                }                if (gunPreifr == "1" || gunPreifr == "2") {                    if (value.PRE_NUM) {                        reportNum = value.PRE_NUM;                    }                    if (value.PRE_DEPT) {                        deptNum = value.PRE_DEPT;                    }                    if (gunNumifr == "1" || gunPreifr == "1") {                        $("#numifrp").html(reportNum);                    } else {                        if (gunNumifr == "2" || gunPreifr == "2") {                            $("#numifr").text(reportNum);                        }                    }                    if (gunDeptifr == "1" || gunPreifr == "1") {                        $("#deptifrp").html(deptNum);                    } else {                        if (gunDeptifr == "2" || gunPreifr == "2") {                            $("#deptifr").text(deptNum);                        }                    }                }                if (data.gunsMsg && data.gunsMsg != "") {                    var tableData = data.gunsMsg;                    var knifeCount = 0;                    $(tableData).each(function (i, d) {                        knifeCount += parseInt(d.CASE_NUM);                        tableHtml += '<tr><td>' + d.GUNS_NUM + '</td>' +                        '<td>' + d.GUNS_FEATURE + '</td>' +                        '<td>' + formats.isIdentify(d.ISIDENTIFY) + '</td><td>' + d.CASE_NUM + '</td></tr>';                    });                    tableHtml = '<tbody id="table2">' +                    '<tr><th>送检编号</th><th>仿真枪基本特征</th><th>是否鉴定</th><th>涉案数量</th></tr>' + tableHtml + '</tbody>';                    $("#tbinfo1").html(tableHtml);                    $("#knifeCount").text(knifeCount);                }            }        }        if (gunPreifr == "1" || gunPreifr == "2") {            $(".preifr,.conclusion").css('display', 'inline-block');        } else {            $(".conclusion,.preifr").hide().remove();        }    },    //重新发起时，可以查看和修改之前的数据    resaveNps: function (data) {        var tableHtml = "";        $(".conclusion,.preifr").hide().remove();        if (data.manMsg && data.manMsg != "") {            var value = data.manMsg[0];            if (value && value != "") {                $("#cyrName").val(value.CYRNAME);                $("#age").val(value.AGE);                $("#address").text(value.ADDRESS);                //$("#counts").val(value.NUM);                $("#caseBrief").text(value.CASEBRIEF);                if(value.GENDER=="02"){                    $("#woman").attr("checked","checked");                    $("#man").removeAttr("checked");                }else{                    $("#man").attr("checked","checked");                    $("#woman").removeAttr("checked");                }            }        }        if (data.gunsMsg && data.gunsMsg != "") {            var tableData = data.gunsMsg;            var knifeCount = 0;            $(tableData).each(function (i, d) {                knifeCount += parseInt(d.CASE_NUM);                tableHtml += '<tr class="gunTds" ' +                'data-no="' + d.GUNS_NUM + '" data-jd="'+ d.ISIDENTIFY+'" data-des="' + d.GUNS_FEATURE + '" data-num="' + d.CASE_NUM + '">' +                '<td>' + d.GUNS_NUM + '</td><td>' + d.GUNS_FEATURE + '</td>' +                '<td>' + numToContent.isIdentify(d.ISIDENTIFY) + '</td><td class="tdDel">' + d.CASE_NUM + '<span class="del"></span></td></tr>';            });            tableHtml = '<tbody id="table2" class="checkTable">' +            '<tr><th>送检编号</th><th>仿真枪基本特征</th><th>是否鉴定</th><th>涉案数量</th></tr>' + tableHtml + '</tbody>';            $("#tbinfo1").html(tableHtml);            $("#knifeCount").text(knifeCount);            if(tableHtml!=""){                $("#tableInfo").val("1");            }        }    },    bind: function () {        var that = this;        $(".tdContent").on("change", "input,textarea", function () {  //table加数格式不正确颜色提示取消            if ($(this).val() != "") {                $(this).removeClass("red");            }        }).blur(function () {            if ($(this).val() != "") {                $(this).removeClass("red");            }        });        //仿真枪页面点击弹出添加枪支信息弹窗        $(".tdBtn").click(function () {            var obj = $(this).prev().attr("id");            $(".modalBg").show();            $(".tdModal").attr("data", obj).show();        });        //仿真枪添加一条数据临时取消按钮        $("#gunCancel").click(function () {            $(".tdModal,.modalBg").fadeOut();            $(".addGunNo,.addGunNum,.addGunDes").val("");        });        $("#business").on("click", ".del", function () {            $(this).parent().parent().hide().remove();        });        //仿真枪添加一条数据临时保存按钮        $("#gunSaveSub").click(function () {            $("#tableInfo").val("1").parent().parent().removeClass("red");            var itemHtml = "";            var gunno = $(".addGunNo").val();            var gunnum = $(".addGunNum").val();            var gundes = $(".addGunDes").val();            var nowNum = $("#knifeCount").text();            var selectVal=$("#ISIDENTIFY").val();            var selectText=$("#ISIDENTIFY").find("option:selected").text();            if (gunno == "") {                $(".addGunNo").addClass("red");            }            if (gunnum == "") {                $(".addGunNum").addClass("red");            }            if (gundes == "") {                $(".addGunDes").addClass("red");            }            if(selectVal==""){                $("#ISIDENTIFY").addClass("red");            }            if (gundes != "" && gunnum != "" && gunno != ""&&selectVal!="") {                $("#knifeCount").text(parseInt(nowNum) + parseInt(gunnum));                $(".tdModal,.modalBg").fadeOut();                itemHtml = '<tr class="gunTds" data-no="' + gunno + '" data-jd="'+selectVal+'" data-des="' + gundes + '" data-num="' + gunnum + '">' +                '<td>' + gunno + '</td><td>' + gundes + '</td>' +'<td>' + selectText + '</td>'+                '<td class="tdDel"><span class="num">' + gunnum + '</span><span class="del"></span></td></tr>';                $("#table2").append(itemHtml);                $(".addGunNo,.addGunNum,.addGunDes,#ISIDENTIFY").val("");                var scrollNum = $(document).height() - $(window).height();                $('html, body').animate({                    scrollTop: scrollNum                }, 1000);            }        });        $("#table2").on("click", ".del", function () { //删除一条            var that = this;            var prevClass = $(this).parent().parent().prev().attr("class");            if (prevClass != "gunTds") {                $("#tableInfo").val("");            } else if (prevClass == "gunTds") {                $("#tableInfo").val("1");            }            var nowCount = $("#knifeCount").text();            var delNum = $(this).prev().text();            if (parseInt(nowCount) > 0) {                $("#knifeCount").text(parseInt(nowCount) - parseInt(delNum));            } else {                $("#knifeCount").text(0);            }            $(this).parent().parent().hide().remove();        });        $("#ISIDENTIFY").change(function(){ //选择是否鉴定            if($(this).val()!=""){                $("#ISIDENTIFY").removeClass("red");            }        });    },    addCheck: function () {        commons.alertMsg(formats.checkFormat());    },add:function() { //表单提交        var tableInfo = [];        $(".gunTds").each(function (i, d) {            tableInfo.push({                "GUNS_NUM": $(this).data("no"),                "GUNS_FEATURE": $(this).data("des"),                "CASE_NUM": $(this).data("num"),                "xh": i,                "ISIDENTIFY":$(this).data("jd")            });        });        var datas = {            "address": $("#address").val(),            "age": $("#age").val(),            "business": businessId,            "caseBrief": $("#caseBrief").val(),            "conclusion": $("#conclusion").val(),            //"counts": $("#counts").val(),            "cyrName": $("#cyrName").val(),            "dept": $("userJob").val(),            "gender": $('input:radio[name="sex"]:checked').val(),            "num": $("#num").val(),            "tableInfo": JSON.stringify(tableInfo)        };        $(".locked").fadeIn();        $(".modalBg").hide();        commons.saveData(datas);    }};single.init();