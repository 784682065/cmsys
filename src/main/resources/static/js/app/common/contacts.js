/** * 通讯录选人Js */var contacts = {    init: function () {        var that = this;        this.bind();        if(pageType=="wp"){ //外跑选人，暂时不能返回            $("#closeContact").hide().remove();            $("#subContact").addClass("big");        }        this.getContact("2089", "oneContact");    },    getContact: function (id, objId) { //获取当前节点的下级通讯录组织人员        $.ajax({            url: server + "dept/allTree?app=Y",            type: "post",            dataType: "json",            async: false,            data: {"id": id},            success: function (data) {                var itemHtml = "";                if (data && data != "") {                    $(data).each(function (i, d) {                        if (d.isParent == true || d.isParent == "true") {                            itemHtml += '<div class="thisUser partItem" id="user' + d.id + '" ' +                            'data-id="' + d.id + '" data-checkdata="' + d.checked + '"' +                            'data-status="ajax" data-parents="' + d.isParent + '">' +                            '<p>' + d.name + '</p></div>' +                            '<div class="nextUser"></div>';                        } else {                            itemHtml += '<div class="thisUser userItem" id="user' + d.id + '" ' +                            'data-id="' + d.id + '" data-checkdata="' + d.checked + '"' +                            'data-status="last" data-parents="' + d.isParent + '">' +                            '<p>' + d.name + '</p><span data-type="child" data-id="' + d.id + '" data-status="no">' +                            '</span></div>';                        }                    });                    if (itemHtml != "") {                        $("#" + objId).next(".nextUser").html(itemHtml);                    } else {                        alert("没有下级组织人员");                    }                }            }, error: function (data) {            }        });    },    bind: function () {        $("#contactList").on("click", ".thisUser", function () {            var id = $(this).attr("data-id");            var obj = $(this).attr("id");            var parent = $(this).attr("data-parents");            if (parent == "true" || parent == true) {                if ($(this).attr("data-status") == "ajax") {                    contacts.getContact(id, obj);                    $(this).attr("data-status", "close").append('<span data-type="parent" data-id="' + id + '" data-status="no">').next(".nextUser").show();                } else if ($(this).attr("data-status") == "open") {                    $(this).attr("data-status", "close").next(".nextUser").show();                } else if ($(this).attr("data-status") == "close") {                    $(this).attr("data-status", "open").next(".nextUser").hide();                }            }        }).on("click", "span", function (e) {            if (e && e.stopPropagation) { //非IE                e.stopPropagation();            } else { //IE                window.event.cancelBubble = true;            }            var id = $(this).attr("data-id");            var status = $(this).attr("data-status");            var type = $(this).attr("data-type");            if (status == "no") {  //未选中的选中操作                $(this).attr("data-status", "yes").parent().addClass("choice");                if (type == "parent") { //父级选中后,自动选中下级已经显示的人,不选中下级部门                    $(this).parent().next().find("span").attr("data-status", "yes").parent().addClass("choice");                }            } else { //已选中的取消选中操作                $(this).attr("data-status", "no").parent().removeClass("choice");                if (type == "parent") { //父级取消选中后取消所有子级的选中状态                    $(this).parent().next().find("span").attr("data-status", "no").parent().removeClass("choice");                } else { //子级取消选中后取消父级的选中状态                    $(this).parent().parent().prev(".thisUser").removeClass("choice");                }            }        });        //点击“选择人员        $(".main").on("click", "#toChoice", function () {            $(".main,.footer").hide();            $(".contacts").show();        });        $("#closeContact").click(function () {            $(".main,.footer").fadeIn(200);            $(".contacts").fadeOut(200);            if ($("#choiceUsers").html() != "") {                $("#toChoice").text("修改选择");            } else {                $("#toChoice").text("选择人员");                $("#choiceUsers").hide();            }        });        $("#subContact").click(function () {            var that = this;            var userIds = [];            var userNames = [];            var num = 0;            $(".choice").each(function () {                if ($(this).attr("data-parents") == "false") {                    num++;                    userIds.push($(this).attr("data-id"));                    userNames.push($(this).find("p").text());                }            });            userNames = userNames.join(",");            userIds = userIds.join(",");            if($(this).data("type")=="important"){                $(".main,.footer").show();                $(".contacts").hide();                $("#meetingNumbers").text(num);                $("#choiceUsers").html(userNames);                $("#objects").val(userIds);                if ($("#choiceUsers").html() != "") {                    $("#choiceUsers").show();                    $("#toChoice").text("修改选择");                } else {                    $("#toChoice").text("选择");                    $("#choiceUsers").hide();                }            }else {                $(".locked").fadeIn();                commons.toPersons(userIds); //流转给多个人            }        });    }};