/** * 内跑公共js * */var nps = {    initAdd: function () {   //添加：发起申请，不同类业务表单使用不同的html模板        var that = this;        commons.bind();        this.bind();         //事件绑定        listType = "add";        $(".footer,#subForm").show();        $("#approval,#reject").hide().remove();        commons.pageVal();        if (needUserInfo == 1) {            commons.getPosterInfo();     //获取当前用户基本信息        }        commons.getMainData();       //获取业务主键及流程ID        commons.pageStyle();             //特殊样式页面渲染    },    initDetail: function () {  //从待办和跟踪列表进入详情的统一方法        var that = this;        commons.bind();        this.bind();           //事件绑定        commons.pageVal();        pageType = "np";        listType = getCookie("listType");     //从列表cookie获取列表类型        businessId = getCookie("businessId"); //从列表cookie获取业务关键ID        if (listType == "wait") {            instanceId = getCookie("instanceId");            nodeId = getCookie("nodeName");            taskId = getCookie("taskId");            prodict = getCookie("prodict");            receiveType = getCookie("receiveType");            commons.getMsgName();    //获取当前用户意见名称            commons.getMsgList();     //流转意见数据获取，必须跟在getMsgName后面            if (receiveType == "view") {                $("#wirte,.footer").hide().remove();                if (msgListNull == 0) {  //预览的时候如果没有意见列表把头也隐藏                    $(".myIdea").parent().hide().remove();                } else {                    $(".myIdea").hide().remove();                }            } else {                commons.getRightBtn();    //底部按钮控件及权限渲染，如果是重新保存的情况渲染页面是input,否则为p            }            commons.getDataInfo();    //内跑页面业务数据获取            commons.getInitTask();   //启动任务            if (saveType == "normal") {                $(".wenxinInfo,.fileDiv").hide().remove();                commons.getMustMsg();    //获取是否必须要提交意见内容            } else {                commons.getMainData();       //获取业务主键及流程ID            }        } else{            $(".footer,.wenxinInfo,.fileDiv").hide().remove();            commons.getDataInfo();            commons.getMsgList();        }        commons.getFileList();    //页面附件列表获取        commons.pageStyle();      //特殊样式页面渲染    },    bind: function () {  // 通用元素事件绑定        var that = this;        $("input[type='date']").change(function () { //日期input样式在手机端美观性，右侧日期ICO显示隐藏            if ($(this).val() == ""&&$(this).attr("id")!="startoff") {                $(this).parent().addClass("dateBg");            } else {                $(this).parent().removeClass("dateBg");            }        }).focus(function () {            if ($(this).val() == "") {                $(this).parent().addClass("dateBg");            } else {                $(this).parent().removeClass("dateBg");            }        });        $(".main").on("change", "#endoff,#startoff", function () {            var start = $("#startoff").val();            var end = $("#endoff").val();            if (start != "" && end != "") {                start = start.replace(/-/g, "/");                var startdate = new Date(start);                end = end.replace(/-/g, "/");                var enddate = new Date(end);                if (enddate.getTime() >= startdate.getTime()) {                    var time = enddate.getTime() - startdate.getTime();                    var days = parseInt(time / (1000 * 60 * 60 * 24)) + 1;                    $("#offdays").html(days);                } else {                    $(".andDate").addClass("red");                    commons.alertMsg("日期起始不能大于结束");                }            }        });        $("#approval").click(function () { //审核同意            submitType = 1;            $(".locked").fadeIn();            $(".modalBg").hide();            if (saveType == "normal") {                nps.normalSub();            } else if (saveType == "resave") {   //重新保存                if (saveDataYes == 0) {       //且业务数据未保存过（只允许保存一次）                    single.addCheck();                } else {                      //且业务数据已保存成功了，直接再发起流程                    commons.alertMsg("正在提交...");                    commons.startProcess(saveDataResult);                }            }        });        $("#reject").click(function () { //驳回            submitType = 2;            $(".locked").fadeIn();            $(".modalBg").hide();            if (saveType == "normal") {                nps.normalSub();            } else if (saveType == "resave") {                commons.endProcess();            }        });        $("#subForm").click(function () { //发起任务，下一步先保存业务数据            $(".locked").fadeIn();            $(".modalBg").hide();            if (saveDataYes == 0) {       //且业务数据未保存过（只允许保存一次）                single.addCheck();            } else {                      //且业务数据已保存成功了，直接再发起流程                commons.alertMsg("正在提交...");                commons.startProcess("");            }        });        //input number不允许输入e        $('input[type=number]').keypress(function(e) {            if (!String.fromCharCode(e.keyCode).match(/[0-9\.]/)) {                return false;            }        });    },    normalSub:function() {  //正常的审核和驳回，不包含重新提交各情况判断        var msgText = $("#ideaText").val();        if (msgText == undefined || msgText == "") {            if (mustGiveMsg == true && mustGiveMsg != "remove") {                commons.alertMsg("请您填写意见");            }        }        if (saveMsged == 0 && msgText && msgText != "" && mustGiveMsg != "remove") {            commons.saveMsg();        } else {            if (mustGiveMsg == false || mustGiveMsg == "remove" || saveMsged == 1) {                if (conclusionifr == "2") {                    commons.saveConclusion();                } else {                    if(submitType==1){                        commons.finished();                    }else if(submitType==2){                        commons.reject();                    }                }            } else {                $(".locked").fadeOut();            }        }    }};