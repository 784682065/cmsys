/** * 表单相关的格式验证,后台返回的数字字段转义为文字 *//* 1.表单相关的格式验证  输入框data-format属性值的对应要验证的格式：forText:文本，单选forSelect：下拉单选,forPhone：手机号码， forEmail：邮箱，forCard：身份证号码，日期不小于现在：forNow。 需要加在输入框父父级元素上的：日期区间企鹅不小于现在：forAnd，checkbox多选。 */var formats = {    checkFormat: function () {        var allright = 0; //0全部无误，1是一个错误...        var info = ["正在提交...", "请正确填写表单", "请完整填写表单", "日期填写有误"];        var resultInfo = "";        var type = "";        $(".checkInput").each(function () {            if (allright == 0) {                type = $(this).data("format");                if (type == "forText") {   //文本验空                    if ($(this).val() == "") {                        resultInfo = info[2];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else {                        $(this).parent().parent().removeClass("red");                    }                } else if (type == "forEmail") {  //验证email格式                    if ($(this).val() == "") {                        resultInfo = info[2];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else if (formats.checkMail($(this).val()) == false || formats.checkMail($(this).val()) == 'false') {                        resultInfo = info[1];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else {                        $(this).parent().parent().removeClass("red");                    }                } else if (type == "forSelect") {  //验证select是否为空                    if ($(this).val() == "999" || $(this).val() == '') {                        resultInfo = info[2];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else {                        $(this).parent().parent().removeClass("red");                    }                } else if (type == "forPhone") {  //验证手机号有效性                    if ($(this).val() == '') {                        resultInfo = info[2];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else if (formats.checkMobile($(this).val()) == false || formats.checkMobile($(this).val()) == 'false') {                        resultInfo = info[1];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else {                        $(this).parent().parent().removeClass("red");                    }                } else if (type == "forCard") {  //验证身份证有效性                    if ($(this).val() == '') {                        resultInfo = info[2];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else if (formats.isCardID($(this).val()) == false || formats.isCardID($(this).val()) == 'false') {                        resultInfo = info[1];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else {                        $(this).parent().parent().removeClass("red");                    }                } else if (type == "forNow") { //验证日期是否小于当前                    var now = new Date().getTime()+61000;                    var date = Date.parse($(this).val().replace(/-/g, "/"));                    if ($(this).val() == '') {                        resultInfo = info[2];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else if (date <= now) {                        resultInfo = info[3];                        allright++;                        $(this).parent().parent().addClass("red");                        return false;                    } else {                        $(this).parent().parent().removeClass("red");                    }                } else if (type == "forAnd") { //验证日期组后面是否大于前面                    var oneDate = "";                    var twoDate = "";                    oneDate = $(this).find(".oneDate").val();                    twoDate = $(this).find(".twoDate").val();                    if (oneDate == '' || twoDate == '') {                        resultInfo = info[2];                        allright++;                        $(this).addClass("red");                        return false;                    } else {                        oneDate = Date.parse(oneDate.replace(/-/g, "/"));                        twoDate = Date.parse(twoDate.replace(/-/g, "/"));                        if (twoDate < oneDate) {                            resultInfo = info[3];                            allright++;                            $(this).addClass("red");                            return false;                        } else {                            $(this).removeClass("red");                        }                    }                } else if (type == "forChecks") {  // 验证checkbox多选是否选择过                    var num = $(this).find("input[type='checkbox']").length;                    var checkNum = 1;                    var obj = $(this).find("input[type='checkbox']");                    var that = this;                    $(obj).each(function () {                        if ($(this).prop('checked')) {   //true 或false                            $(that).removeClass("red");                            return false;                        } else if (checkNum != num) {                            checkNum++;                        } else if (checkNum == num) {                            $(that).addClass("red");                        }                    });                }            }        });        if (resultInfo == "") {  //如果验证都正确提示“正在提交”            resultInfo = info[0];            single.add();  //准备保存业务数据        } else {            $(".locked").fadeOut();        }        return resultInfo;    },    strToJson: function (str) { //字符串转换为json        return eval('(' + str + ')');    }, checkMobile: function (str) { //11位手机号码验证        var mobileReg = /^(((13[0-9]{1})|(15[0-9]{1})|(17[0-9]{1})|(18[0-9]{1})|(19[0-9]{1}))+\d{8})$/;        return mobileReg.test(str);    }, checkMail: function (str) { //邮箱Email验证        var mailReg = /^[A-Za-z\d]+([-_.][A-Za-z\d]+)*@([A-Za-z\d]+[-.])+[A-Za-z\d]{2,4}$/;        return mailReg.test(str);    }, isCardID: function (sId) { //身份证验证        var iSum = 0;        var aCity = {            11: "北京",            12: "天津",            13: "河北",            14: "山西",            15: "内蒙古",            21: "辽宁",            22: "吉林",            23: "黑龙江",            31: "上海",            32: "江苏",            33: "浙江",            34: "安徽",            35: "福建",            36: "江西",            37: "山东",            41: "河南",            42: "湖北",            43: "湖南",            44: "广东",            45: "广西",            46: "海南",            50: "重庆",            51: "四川",            52: "贵州",            53: "云南",            54: "西藏",            61: "陕西",            62: "甘肃",            63: "青海",            64: "宁夏",            65: "新疆",            71: "台湾",            81: "香港",            82: "澳门",            91: "国外"        };        if (!/^\d{17}(\d|x)$/i.test(sId)) {            return false;        }        sId = sId.replace(/x$/i, "a");        if (aCity[parseInt(sId.substr(0, 2))] == null) {            return false;        }        var sBirthday = sId.substr(6, 4) + "-" + Number(sId.substr(10, 2)) + "-" + Number(sId.substr(12, 2));        var d = new Date(sBirthday.replace(/-/g, "/"));        if (sBirthday != (d.getFullYear() + "-" + (d.getMonth() + 1) + "-" + d.getDate())) {            return false;        }        for (var i = 17; i >= 0; i--) {            iSum += (Math.pow(2, i) % 11) * parseInt(sId.charAt(17 - i), 11);        }        if (iSum % 11 != 1) {            return false;        }        return true;    },    timeFormat: function (dates, type) { //日期时间格式转换        var newDate;        if (dates == null || dates == "null" || dates == "") {            return "";        } else if (dates == "now") {            newDate = new Date();        } else {            newDate = new Date(dates);        }        var year = newDate.getFullYear();        var day = newDate.getDate();        var month = newDate.getMonth() + 1;        var minute = newDate.getMinutes();        var hours = newDate.getHours();        var seconds = newDate.getSeconds();        var date = "";        (month < 10) ? month = "0" + month : "";        (day < 10) ? day = "0" + day : "";        (hours < 10) ? hours = "0" + hours : "";        (minute < 10) ? minute = "0" + minute : "";        (seconds < 10) ? seconds = "0" + seconds : "";        if (type == "year") {            date = year + "-" + month + "-" + day;        } else if (type == "full") {            date = year + "-" + month + "-" + day + " " + hours + ":" + minute + ":" + seconds;        } else if (type == "year0") {            date = year + "-" + month + "-" + day + " 00:00:00";        } else if (type == "month") {            date = month + "-" + day + " " + hours + ":" + minute + ":" + seconds;        } else if (type == "zh") {            date = year + "年" + month + "月" + day + "日";        } else if (type == "month-day") {            date = month + "-" + day;        } else if (type == "yearMonthDay") {            date = year + "" + month + "" + day;        } else if (type == "times") {            date = year + month + day + "000000";        }        return date;    }};/** * 2.后台返回的数字字段转义为文字 */var numToContent = {    sexContent: function (str) { //性别        if (str == "01"||str == "1") {            return "男";        } else {            return "女";        }    },    sfkdText: function (str) { //是否快递，是否参加社保        if (str == "00" || str == "0") {            return "否";        } else {            return "是";        }    },sbzText:function(str){ //申报者        if (str == "01") {            return "个人";        } else if(str == "02"){            return "企业";        } else if(str == "03"){            return "非企业";        }    }, identifyText:function(str){ //管制刀具和仿真枪，是否鉴定        if (str == "1" || str == "Y") {            return "已鉴定";        } else{            return "未鉴定";        }    },bpsqlb:function(str){ //爆破作业人员：申请类别        if (str == "01") {            return "初次申领";        } else if(str == "02"){            return "到期换发";        } else if(str == "03"){            return "变更单位换发";        } else if(str == "04"){            return "补发";        } else if(str == "05"){            return "提高资格等级";        }    },sqbpzylb:function(str){ //爆破作业人员，申请爆破作业类别        var text=[];        str=str.split(",");        for(var i=0;i<str.length;i++){            if (str[i]=="01") {                text.push("爆破员");            }            if (str[i]=="02") {                text.push("安全员");            }            if (str[i]=="03") {                text.push("保管员");            }            if (str[i]=="0401") {                text.push("爆破工程技术人员（高级/A）");            }            if (str[i]=="0402") {                text.push("爆破工程技术人员（高级/B）");            }            if (str[i]=="0403") {                text.push("爆破工程技术人员（高级/C）");            }            if (str[i]=="0404") {                text.push("爆破工程技术人员（高级/D）");            }        }        return text.join(",");    },bagsfwfw:function(str){  //设立保安服务公司和保安服务公司跨省备案，服务范围        var text=[];        str=str.split(",");        for(var i=0;i<str.length;i++) {            if (str[i] == "01") {                text.push("门卫");            }            if (str[i] == "02") {                text.push("巡逻");            }            if (str[i] == "03") {                text.push("守护");            }            if (str[i] == "04") {                text.push("押运");            }            if (str[i] == "05") {                text.push("随身防护");            }            if (str[i] == "06") {                text.push("安全检查");            }            if (str[i] == "07") {                text.push("安全技术防范");            }            if (str[i] == "08") {                text.push("安全技术防范");            }            if (str[i] == "09") {                text.push("安全风险评估");            }        }        return text.join(",");    },     isIdentify:function(str){         if (str == "1") {             return "已鉴定";         }else if (str == "2") {             return "未鉴定";         }    }};